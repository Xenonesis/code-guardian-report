<!DOCTYPE html>
<html>
<head>
    <title>Test Analysis</title>
</head>
<body>
    <h1>Testing Analysis Engine</h1>
    <button id="runTest">Run Test</button>
    <pre id="output"></pre>

    <script type="module">
        import { EnhancedAnalysisEngine } from './src/services/enhancedAnalysisEngine.ts';
        import JSZip from 'jszip';

        const output = document.getElementById('output');
        
        document.getElementById('runTest').addEventListener('click', async () => {
            output.textContent = 'Running test...\n';
            
            try {
                const engine = new EnhancedAnalysisEngine();
                
                // Create test code with SQL injection
                const testCode = `
const express = require('express');
const mysql = require('mysql');

app.get('/user', (req, res) => {
  const userId = req.query.id;
  const query = "SELECT * FROM users WHERE id = '" + userId + "'";
  connection.query(query, (err, results) => {
    res.json(results);
  });
});
                `;
                
                // Create ZIP
                const zip = new JSZip();
                zip.file('test_sql.js', testCode);
                const zipBlob = await zip.generateAsync({ type: 'blob' });
                
                // Run analysis
                output.textContent += 'Analyzing...\n';
                const results = await engine.analyzeCodebase(zipBlob);
                
                output.textContent += '\nResults:\n';
                output.textContent += `Total Issues: ${results.issues.length}\n`;
                output.textContent += `Total Files: ${results.totalFiles}\n`;
                output.textContent += `Analysis Time: ${results.analysisTime}\n\n`;
                
                if (results.issues.length > 0) {
                    output.textContent += 'Issues Found:\n';
                    results.issues.forEach((issue, i) => {
                        output.textContent += `${i + 1}. ${issue.type} (${issue.severity}): ${issue.message}\n`;
                    });
                } else {
                    output.textContent += 'NO ISSUES FOUND!\n';
                }
                
                output.textContent += '\n\nFull Results:\n' + JSON.stringify(results, null, 2);
            } catch (error) {
                output.textContent += '\nError: ' + error.message + '\n';
                output.textContent += error.stack;
            }
        });
    </script>
</body>
</html>
